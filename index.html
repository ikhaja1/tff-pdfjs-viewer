<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>TFF PDF Viewer</title>

    <!-- Load PDF.js from your GitHub repo -->
    <script src="pdfjs/pdf.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background: #f3f3f3;
        }
        #viewerContainer {
            width: 100%;
            height: 100%;
            overflow: auto;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <div id="viewerContainer"></div>

    <script>
        // ✔ Step 1: Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = "pdfjs/pdf.worker.js";

        // ✔ Step 2: Get file URL from query parameters
        const pdfUrl = new URLSearchParams(window.location.search).get("file");

        if (!pdfUrl) {
            document.body.innerHTML =
                "<h2 style='text-align:center;margin-top:50px;'>No PDF file provided</h2>";
        } else {
            // ✔ Step 3: Load and render PDF
            const loadingTask = pdfjsLib.getDocument(pdfUrl);

            loadingTask.promise.then(pdf => {
                console.log("PDF loaded. Pages:", pdf.numPages);

                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    pdf.getPage(pageNum).then(page => {
                        const viewport = page.getViewport({ scale: 1.35 });

                        const canvas = document.createElement("canvas");
                        const context = canvas.getContext("2d");
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        document.getElementById("viewerContainer").appendChild(canvas);

                        page.render({
                            canvasContext: context,
                            viewport: viewport,
                        });
                    });
                }
            }).catch(err => {
                document.body.innerHTML =
                    "<h2 style='text-align:center;margin-top:50px;color:red;'>Failed to load PDF</h2>" +
                    "<pre>" + err + "</pre>";
            });
        }
    </script>

</body>
</html>
